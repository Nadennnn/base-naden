<div class="space-y-4">
  <!-- Header + Total -->
  <div
    class="p-4 border bg-gradient-to-br from-green-500/20 to-green-900/10 rounded-2xl border-green-500/20"
  >
    <p class="mb-1 text-xs text-gray-400">Total Pendapatan Bulan Ini</p>
    <h2 class="text-2xl font-bold text-white">{{ totalPendapatan | rupiah }}</h2>
    <p class="mt-1 text-xs text-green-400">{{ jumlahSumber }} sumber pendapatan</p>
  </div>

  <!-- Breakdown per Sumber -->
  <div class="p-4 bg-gray-900 border border-gray-800 rounded-2xl">
    <h3 class="mb-3 text-sm font-semibold">Breakdown Sumber</h3>
    <div class="space-y-3">
      <div *ngFor="let sumber of breakdownSumber" class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div
            class="flex items-center justify-center w-8 h-8 rounded-xl"
            [style.background]="sumber.bgColor"
          >
            <span class="text-sm">{{ sumber.emoji }}</span>
          </div>
          <div>
            <p class="text-sm font-medium">{{ sumber.nama }}</p>
            <p class="text-xs text-gray-400">{{ sumber.kategori }}</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-sm font-semibold text-green-400">{{ sumber.nominal | rupiah }}</p>
          <p class="text-xs text-gray-500">{{ sumber.persentase }}%</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Riwayat Pendapatan -->
  <div>
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-sm font-semibold">Riwayat</h3>
    </div>

    <div class="space-y-2">
      <ng-container *ngIf="riwayat.length > 0; else emptyState">
        <div
          *ngFor="let item of riwayat"
          class="flex items-center justify-between p-3 bg-gray-900 border border-gray-800 rounded-xl"
        >
          <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-9 h-9 rounded-xl bg-green-500/20">
              <lucide-icon name="trending-up" [size]="16" class="text-green-400"></lucide-icon>
            </div>
            <div>
              <p class="text-sm font-medium">{{ item.sumber }}</p>
              <p class="text-xs text-gray-400">
                {{ item.kategori }} Â· {{ item.tanggal | date: 'dd MMM yyyy' }}
              </p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm font-semibold text-green-400">+{{ item.nominal | rupiah }}</span>
            <button
              (click)="hapus(item.id)"
              class="text-gray-600 transition-colors hover:text-red-400"
            >
              <lucide-icon name="trash-2" [size]="14"></lucide-icon>
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyState>
        <div class="flex flex-col items-center justify-center py-12 text-center">
          <lucide-icon name="inbox" [size]="40" class="mb-3 text-gray-600"></lucide-icon>
          <p class="text-sm text-gray-500">Belum ada pendapatan</p>
          <p class="mt-1 text-xs text-gray-600">Tap tombol + untuk menambahkan</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- FAB -->
<app-fab-button (onClick)="bukaForm()"></app-fab-button>

<!-- Bottom Sheet Form -->
<app-bottom-sheet [isOpen]="isFormOpen" title="Tambah Pendapatan" (onClose)="tutupForm()">
  <form [formGroup]="form" (ngSubmit)="simpan()" class="space-y-4">
    <!-- Nominal -->
    <div>
      <label class="block mb-1 text-xs text-gray-400">Nominal</label>
      <div class="relative">
        <span class="absolute text-sm text-gray-400 -translate-y-1/2 left-3 top-1/2">Rp</span>
        <input
          type="number"
          formControlName="nominal"
          placeholder="0"
          class="w-full py-3 pl-10 pr-4 text-sm text-white bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-indigo-500"
        />
      </div>
    </div>

    <!-- Sumber -->
    <div>
      <label class="block mb-1 text-xs text-gray-400">Sumber Pendapatan</label>
      <input
        type="text"
        formControlName="sumber"
        placeholder="Contoh: ADS, ADHIVAS, Freelance..."
        class="w-full px-4 py-3 text-sm text-white bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-indigo-500"
      />
    </div>

    <!-- Kategori -->
    <div>
      <label class="block mb-1 text-xs text-gray-400">Kategori</label>
      <select
        formControlName="kategori_id"
        class="w-full px-4 py-3 text-sm text-white bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-indigo-500"
      >
        <option value="" disabled>Pilih kategori</option>
        <option *ngFor="let kat of kategoriList" [value]="kat.value">{{ kat.label }}</option>
      </select>
    </div>

    <!-- Keterangan -->
    <div>
      <label class="block mb-1 text-xs text-gray-400"
        >Keterangan <span class="text-gray-600">(opsional)</span></label
      >
      <input
        type="text"
        formControlName="keterangan"
        placeholder="Catatan tambahan..."
        class="w-full px-4 py-3 text-sm text-white bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-indigo-500"
      />
    </div>

    <!-- Tanggal -->
    <div>
      <label class="block mb-1 text-xs text-gray-400">Tanggal</label>
      <input
        type="date"
        formControlName="tanggal"
        class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white text-sm focus:outline-none focus:border-indigo-500 [color-scheme:dark]"
      />
    </div>

    <!-- Submit -->
    <button
      type="submit"
      [disabled]="form.invalid"
      class="w-full py-3 font-semibold text-white transition-colors bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl"
    >
      Simpan Pendapatan
    </button>
  </form>
</app-bottom-sheet>
